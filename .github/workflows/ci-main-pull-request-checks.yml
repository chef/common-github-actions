# CI pipeline for all application types on main and release branches
# use stubs/ci-main-pull-request-checks-stub.yml in your repo to call this common action using workflow_call
name: main and release branch CI flow

on:
  workflow_call:
    inputs:
    #   message:
    #     required: true
    #     type: string
      language:
        description: 'Primary language in the repository'
        required: true
        type: string
      outputfilename:
        description: 'Name of the SCC output file'
        required: false
        type: string
        default: 'scc-output.txt'

jobs:
#   reusable_echo:
#     name: echo message back
#     runs-on: ubuntu-latest
#     steps:
#       - name: echo
#         run: |
#           echo "Hello ${{ inputs.message }}"

  # sections to always run (language-independent)
  run-scc:
    name: source code complexity scan    
    uses: chef/common-github-actions/.github/workflows/scc.yml@main
    with:
      outputfilename: ${{ inputs.outputfilename }}

  run-trufflehog:
    uses: chef/common-github-actions/.github/workflows/trufflehog.yml@main
   
  run-sonarqube:
    uses: chef/common-github-actions/.github/workflows/ruby-sonarqube.yml@main
    secrets: inherit
    
  # sections for language specific tests (gosec, etc.)
  run-Ruby-language-specific-tests:
    if: ${{ inputs.language == 'Ada' }}  # Check if "DEPLOY_ENV" is "production"
    uses: chef/common-github-actions/.github/workflows/ruby-sonarqube.yml@main

    # https://docs.github.com/en/actions/sharing-automations/reusing-workflows#passing-inputs-and-secrets-to-a-reusable-workflow
  